<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="AsciiDoc 8.6.9">
<title>Installing Arvados Keep With Authentication and Replication</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}
pre {
  white-space: pre-wrap;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; vertical-align: text-bottom; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}


</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install();
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>Installing Arvados Keep With Authentication and Replication</h1>
<span id="author">Frederick M. Muriithi</span><br>
<span id="email" class="monospaced">&lt;<a href="mailto:fredmanglis@gmail.com">fredmanglis@gmail.com</a>&gt;</span><br>
<span id="revdate">20 June 2017</span>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph"><p>Arvados Keep is a content-addressable storage system. To quote from <a href="https://arvados.org/">Arvados</a>:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>Keep is a content-addressable storage system for managing and storing large collections of files with durable, cryptographically verifiable references and high-throughput processing. Keep works on a wide range of underyling file systems.</pre>
</div></div>
<div class="paragraph"><p>The core Arvados system is composed of many parts, but our focus is on using the Keep service, while providing both authentication of users and replication of the content across a variety of servers.</p></div>
<div class="paragraph"><p>To do this, we require the following parts of the arvados core system:</p></div>
<div class="ulist"><ul>
<li>
<p>
The Arvados SSO server
</p>
</li>
<li>
<p>
The Arvados API server
</p>
</li>
<li>
<p>
The Shell server
</p>
</li>
<li>
<p>
The Keepstore server
</p>
</li>
<li>
<p>
The keep-balance
</p>
</li>
</ul></div>
<div class="paragraph"><p>We shall look at each of this parts in the following sections.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_installation">Installation</h2>
<div class="sectionbody">
<div class="paragraph"><p>There are some <a href="http://doc.arvados.org/install/install-manual-prerequisites.html">prerequisite steps</a> to follow before installing any of the various parts. Of particular note is the <em>unique identifier</em>, generally referred to as <em>uuid_prefix</em> in the Arvados documentation.</p></div>
<div class="paragraph"><p>There is also need to <a href="http://doc.arvados.org/install/install-postgresql.html">set up the PostgreSQL databases</a> for both the API server and the SSO server.</p></div>
<div class="paragraph"><p>Please do so before continuing.</p></div>
<div class="sect2">
<h3 id="_arvados_single_sign_on_server">Arvados Single Sign-On Server</h3>
<div class="paragraph"><p>The <em>arvados-sso-server</em> provides a way to authenticate users and clients before giving the access to the various arvados services.</p></div>
<div class="sect3">
<h4 id="_installing_the_sso_server">Installing the SSO Server</h4>
<div class="paragraph"><p>Please follow <a href="http://doc.arvados.org/install/install-sso.html">these instructions</a> to install and configure the SSO server.</p></div>
<div class="paragraph"><p>The following are some important configuration options arranged by the default file they are found in:</p></div>
<div class="sect4">
<h5 id="_etc_arvados_sso_application_yml">/etc/arvados/sso/application.yml</h5>
<div class="dlist"><dl>
<dt class="hdlist1">
uuid_prefix
</dt>
<dd>
<p>
This is the unique identifier that was generated in the <a href="http://doc.arvados.org/install/install-manual-prerequisites.html">prerequisite steps</a> pointed to above. It is configured in the <em>/etc/arvados/sso/application.yml</em> file.
</p>
</dd>
<dt class="hdlist1">
secret_token
</dt>
<dd>
<p>
This token is used by the SSO server to sign cookies. It should be unique to the site, and should be kept secret.
</p>
</dd>
<dt class="hdlist1">
site_title
</dt>
<dd>
<p>
The name of the site. This is the name shown to the site visitors to identify the site. It is configured in the <em>/etc/arvados/sso/application.yml</em> file.
</p>
</dd>
<dt class="hdlist1">
default_link_title and default_link_url
</dt>
<dd>
<p>
Presented to the user after logging in as the default destination. The title is provided as a clickable hypertext link to the url.
</p>
</dd>
<dt class="hdlist1">
allow_account_registration
</dt>
<dd>
<p>
If set to true, the system will allow creation of new user accounts in the SSO&#8217;s internal database. If set to false, it will not allow creation of new user accounts.
</p>
</dd>
</dl></div>
</div>
<div class="sect4">
<h5 id="_etc_arvados_sso_database_yml">/etc/arvados/sso/database.yml</h5>
<div class="dlist"><dl>
<dt class="hdlist1">
database
</dt>
<dd>
<p>
This is the name of the SSO server database name as was set up in the <a href="http://doc.arvados.org/install/install-postgresql.html">database setup</a> process.
</p>
</dd>
<dt class="hdlist1">
username
</dt>
<dd>
<p>
The username that has access to the SSO server database
</p>
</dd>
<dt class="hdlist1">
password
</dt>
<dd>
<p>
The password that was used while creating the SSO server database
</p>
</dd>
<dt class="hdlist1">
host
</dt>
<dd>
<p>
The hostname on which the SSO server database is.
</p>
</dd>
</dl></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_arvados_api_server">Arvados API Server</h3>
<div class="paragraph"><p>The API server binds the various parts of the Arvados system. It is used by various clients to access the various Arvados services.</p></div>
<div class="sect3">
<h4 id="_installing_the_api_server">Installing the API Server</h4>
<div class="paragraph"><p>The process to install and configure the API server is documented <a href="http://doc.arvados.org/install/install-api-server.html">here</a>.</p></div>
<div class="paragraph"><p>The following are some of the most important configurations ordered by the default file where they are:</p></div>
<div class="sect4">
<h5 id="_etc_arvados_api_application_yml">/etc/arvados/api/application.yml</h5>
<div class="dlist"><dl>
<dt class="hdlist1">
uuid_prefix
</dt>
<dd>
<p>
This is the unique identifier that was generated in the <a href="http://doc.arvados.org/install/install-manual-prerequisites.html">prerequisite steps</a> pointed to above.
</p>
</dd>
<dt class="hdlist1">
secret_token
</dt>
<dd>
<p>
This token should be unique for each site, and should be secret. It is used by the system to sign cookies. It is recommended that it be at least 50 characters long.
</p>
</dd>
<dt class="hdlist1">
sso_app_secret
</dt>
<dd>
<p>
The API server uses this token to authenticate itself to the SSO Server. It is generated when installing the SSO Server.
</p>
</dd>
<dt class="hdlist1">
sso_app_id
</dt>
<dd>
<p>
A string value that acts as a sort of id for this server. Make this unique if you can.
</p>
</dd>
<dt class="hdlist1">
sso_provider_url
</dt>
<dd>
<p>
This is the uri by which the API server can access the SSO server.
</p>
</dd>
</dl></div>
</div>
<div class="sect4">
<h5 id="_etc_arvados_api_database_yml">/etc/arvados/api/database.yml</h5>
<div class="dlist"><dl>
<dt class="hdlist1">
database
</dt>
<dd>
<p>
This is the name of the API server database name as was set up in the <a href="http://doc.arvados.org/install/install-postgresql.html">database setup</a> process.
</p>
</dd>
<dt class="hdlist1">
username
</dt>
<dd>
<p>
The username that has access to the API server database
</p>
</dd>
<dt class="hdlist1">
password
</dt>
<dd>
<p>
The password that was used while creating the API server database
</p>
</dd>
<dt class="hdlist1">
host
</dt>
<dd>
<p>
The hostname on which the API server database is.
</p>
</dd>
</dl></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_shell_server">The Shell Server</h3>
<div class="paragraph"><p>This part provides some utilities useful in configuring and testing the other parts of the system. It also provides the SDK.</p></div>
<div class="paragraph"><p>Please follow the process <a href="http://doc.arvados.org/install/install-shell-server.html">here</a> to install the shell server.</p></div>
<div class="paragraph"><p>The shell server does not have much configuration to do.</p></div>
</div>
<div class="sect2">
<h3 id="_the_keepstore_server">The Keepstore Server</h3>
<div class="paragraph"><p>This is the heart of the storage system we are building. It is this component that actually stores the data on whichever volumes it has been configured to use.</p></div>
<div class="sect3">
<h4 id="_installing_and_configuring_keepstore">Installing and Configuring Keepstore</h4>
<div class="paragraph"><p>There are 2 ways to install:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
With GNU Guix
</dt>
<dd>
<div class="ulist"><ul>
<li>
<p>
Clone <a href="https://github.com/fredmanglis/guix-arvados">this repository</a>.
</p>
</li>
<li>
<p>
Set up <span class="monospaced">GUIX_PACKAGE_PATH</span> environment variable. For example, if you cloned the repository into the following directory <em>$HOME/repositories/guix-arvados</em> run, <span class="monospaced">export GUIX_PACKAGE_PATH=$HOME/repositories/guix-arvados</span>
</p>
</li>
<li>
<p>
Install: run <span class="monospaced">guix package --install=arvados-keepstore</span>
</p>
</li>
<li>
<p>
Test that keepstore was installed: run <span class="monospaced">keepstore --help</span>
</p>
</li>
</ul></div>
</dd>
<dt class="hdlist1">
According to Arvados Documentation
</dt>
<dd>
<p>
Follow <a href="http://doc.arvados.org/install/install-keepstore.html">the keepstore installation</a> process on the Arvados documentation.
</p>
</dd>
</dl></div>
<div class="sect4">
<h5 id="_configuration">Configuration</h5>
<div class="paragraph"><p>To understand the configuration variables, you can do <span class="monospaced">keepstore -h</span> and read the output to understand the variables. The following is an explanation on some of the important ones:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
Listen
</dt>
<dd>
<p>
The address and port where the keepstore server will listen for incoming connections.
</p>
</dd>
<dt class="hdlist1">
LogFormat
</dt>
<dd>
<p>
The form in which the log output from keepstore will be in. The valid values are <em>"json"</em> and <em>"text"</em>. The format of the requests and responses will also be affected by this setting.
</p>
</dd>
<dt class="hdlist1">
BlobSigningKeyFile
</dt>
<dd>
<p>
This is a path to the local file containing the secret key that is used for generating and verifying blobs. It should be the same key as the API server&#8217;s blob_signing_key.
</p>
</dd>
<dt class="hdlist1">
RequireSignatures
</dt>
<dd>
<p>
If set to true, only those read requests that contain a valid signature will receive the content requested in the read request. If the signature is invalid, or no signature is provided, the system responds to the request with <em>Forbidden</em>. If this setting is set to false, then all read requests are allowed. It is thus recommended that this setting be true.
</p>
</dd>
<dt class="hdlist1">
SystemAuthTokenFile
</dt>
<dd>
<p>
This is the path to the local file containing the Arvados API token used by <em>keep-balance</em>.
</p>
</dd>
<dt class="hdlist1">
Volumes
</dt>
<dd>
<p>
This is a list of the storage volumes that keepstore will use to save data in. If omitted, keepstore will, by default, use all directories named "keep" at the top-level of a mount point at startup. The valid volume types are, Azure, Directory, and S3
</p>
</dd>
</dl></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_keep_balance">Keep-balance</h3>
<div class="paragraph"><p>Keep-balance provides replication to the saved content. It also handles deletion of blocks. To quote the Arvados documentation:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>Keep-balance deletes unreferenced and overreplicated blocks from Keep servers, makes additional copies of underreplicated blocks, and moves blocks into optimal locations as needed (e.g., after adding new servers).</pre>
</div></div>
<div class="paragraph"><p>There are two ways to install keep-balance:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
With GNU Guix
</dt>
<dd>
<div class="ulist"><ul>
<li>
<p>
Clone <a href="https://github.com/fredmanglis/guix-arvados">this repository</a>.
</p>
</li>
<li>
<p>
Set up <span class="monospaced">GUIX_PACKAGE_PATH</span> environment variable. For example, if you cloned the repository into the following directory <em>$HOME/repositories/guix-arvados</em> run, <span class="monospaced">export GUIX_PACKAGE_PATH=$HOME/repositories/guix-arvados</span>
</p>
</li>
<li>
<p>
Install: run <span class="monospaced">guix package --install=arvados-keep-balance</span>
</p>
</li>
<li>
<p>
Test that keepstore was installed: run <span class="monospaced">keep-balance --help</span>
</p>
</li>
</ul></div>
</dd>
<dt class="hdlist1">
According to arvados documentation
</dt>
<dd>
<div class="ulist"><ul>
<li>
<p>
Follow <a href="https://doc.arvados.org/install/install-keep-balance.html">the instructions here</a>. This page also contains the configuration details for keep-balance.
</p>
</li>
</ul></div>
</dd>
</dl></div>
<div class="paragraph"><p>Keep-balance expects that the API server be served over https, and will complain if it is not. If the certificate of the API server is self-signed, then the <em>Insecure</em> option in the <em>Client</em> section of the configuration needs to be set to <span class="monospaced">true</span>.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_other_useful_components">Other Useful Components</h2>
<div class="sectionbody">
<div class="paragraph"><p>Two other arvados components may also be useful to set up. They are not mandatory, but may prove useful in some scenarios. These components are Keep-web server and Keep-proxy server.</p></div>
<div class="sect2">
<h3 id="_keep_web_server">Keep-web Server</h3>
<div class="paragraph"><p>Quoting the <a href="https://doc.arvados.org/install/install-keep-web.html">keep-web installation page</a>,</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>The Keep-web server provides read-only HTTP access to files stored in Keep. It serves public data to unauthenticated clients, and serves private data to clients that supply Arvados API tokens. It can be installed anywhere with access to Keep services, typically behind a web proxy that provides SSL support.</pre>
</div></div>
<div class="paragraph"><p>Please see the page linked above to install and configure.</p></div>
</div>
<div class="sect2">
<h3 id="_keep_proxy_server">Keep-proxy Server</h3>
<div class="paragraph"><p>This allows clients that are not on the local network to access and use the keepstore servers. See <a href="https://doc.arvados.org/install/install-keepproxy.html">this page</a> to install and configure the Keep-proxy server.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_repositories">Repositories</h2>
<div class="sectionbody">
<div class="paragraph"><p>Here is a list of the code repositories for the various parts of the system:</p></div>
<div class="ulist"><ul>
<li>
<p>
The SSO Server repository can be found <a href="https://github.com/curoverse/sso-devise-omniauth-provider">here</a>.
</p>
</li>
<li>
<p>
The API server, shell server, keepstore, keep-balance are in a single repository <a href="https://github.com/curoverse/arvados">here</a>
</p>
</li>
</ul></div>
</div>
</div>
</div>
<div id="footnotes"><hr></div>
<div id="footer">
<div id="footer-text">
Last updated 2017-06-29 16:10:53 EAT
</div>
</div>
</body>
</html>
